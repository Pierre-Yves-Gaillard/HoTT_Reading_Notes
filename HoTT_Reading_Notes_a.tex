%\title{HoTT Reading Notes a}
% http://goo.gl/Dz6r8g
% https://docs.google.com/document/d/15-yaLYocktW8PtUeiKjTupslbpdnDs0HH5GIZA20Sxc/edit
% https://github.com/Pierre-Yves-Gaillard/HoTT_Reading_Notes/blob/master/HoTT_Reading_Notes_a.tex 
% http://iecl.univ-lorraine.fr/~Pierre-Yves.Gaillard/HoTT/ReadingNotes
% https://docs.google.com/document/d/15-yaLYocktW8PtUeiKjTupslbpdnDs0HH5GIZA20Sxc/edit?usp=sharing
% !TEX encoding = UTF-8 Unicode
\documentclass[12pt]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amssymb,amsmath}
\usepackage[a4paper]{geometry}
\usepackage{datetime}
\usepackage[pdfusetitle]{hyperref}%colorlinks, urlbordercolor={0 1 1}?
\addtolength{\parskip}{.5\baselineskip}
%\renewcommand{\baselinestretch}{1.1}
%\pagestyle{empty}
\newcommand{\mbb}{\mathbb}
\newcommand{\mbf}{\mathbf}
\newcommand{\msf}{\mathsf}
\newcommand{\ack}{\mathsf{ack}}
\newcommand{\ap}{\mathsf{ap}}
\newcommand{\apd}{\mathsf{apd}}
\newcommand{\cc}{\cdot}
\newcommand{\code}{\mathsf{code}}
\newcommand{\dd}{\displaystyle}
\newcommand{\de}{:\equiv}
\newcommand{\ee}{\equiv}
\newcommand{\fu}{\mathsf{funext}}
\newcommand{\id}{\mathsf{id}}
\newcommand{\ind}{\mathsf{ind}}
\newcommand{\inl}{\mathsf{inl}}
\newcommand{\inr}{\mathsf{inr}}
\newcommand{\la}{\lambda}
\newcommand{\N}{\mathbb N}
\newcommand{\nn}{\noindent}
\newcommand{\oo}{\operatorname}
\newcommand{\p}{\varphi}
\newcommand{\pa}{\mathsf{pair}^=}
\newcommand{\pr}{\mathsf{pr}}
\newcommand{\rec}{\mathsf{rec}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\sm}{\scriptstyle}
\newcommand{\su}{\mathsf{succ}}
\newcommand{\tr}{\mathsf{transport}}
\newcommand{\two}{\mathbf2}
\newcommand{\U}{\mathcal U}
\newcommand{\ua}{\mathsf{ua}}
\newcommand{\uniq}{\mathsf{uniq}}
\title{HoTT Reading Notes}
\author{Pierre-Yves Gaillard}
\date{\today, \currenttime}
\begin{document}
% $$\text{mathbf }\mathbf1,\text{ pmb }\pmb1,\text{ boldsymbol }\boldsymbol1$$ \tiny, \scriptsize, \footnotesize, \small, \normalsize, \large, \Large, \LARGE, \huge, \Huge

\maketitle%\nn\today, \currenttime

\nn This text is available at 

\nn\href{http://iecl.univ-lorraine.fr/~Pierre-Yves.Gaillard/HoTT/ReadingNotes}{http://iecl.univ-lorraine.fr/$\sim$Pierre-Yves.Gaillard/HoTT/ReadingNotes}

%\nn\href{http://iecl.univ-lorraine.fr/~Pierre-Yves.Gaillard/HoTT/ReadingNotes}{http://iecl.univ-lorraine.fr/\textasciitilde Pierre-Yves.Gaillard/HoTT/ReadingNotes}

\nn\href{https://github.com/Pierre-Yves-Gaillard/HoTT_Reading_Notes}{https://github.com/Pierre-Yves-Gaillard/HoTT\_Reading\_Notes}

\nn\href{http://goo.gl/Dz6r8g}{http://goo.gl/Dz6r8g}

This is an informal set of comments on the HoTT Book:

\nn\href{http://homotopytypetheory.org/book}{http://homotopytypetheory.org/book}

This is a work in progress. John Dougherty's text 

\nn\href{https://github.com/jdoughertyii/hott-exercises}{https://github.com/jdoughertyii/hott-exercises}

\nn has been most helpful.

\tableofcontents%\newpage

%%

\section{Chapter 1}

\subsection{Exercise 1.3} 

\emph{Statement.} Derive the induction principle for products $\ind_{A\times B}$, using only the projections and the propositional uniqueness principle $\uniq_{A\times B}$. Verify that the definitional equalities are valid. Generalize $\uniq_{A\times B}$ to $\Sigma$-types, and do the same for $\Sigma$-types. \emph{(This requires concepts from Chapter~2.)}

\nn\emph{Solution.} It suffices to handle $\Sigma$-types. 

\nn(a) We assume that, for all type family $B:A\to\U$ we have a map 
$$
\pr_1:\left(\sum_{a:A}B(a)\right)\to A,
$$ 
a dependent function 
$$
\pr_2:\prod_{x:\sum_{a:A}B(a)}B(\pr_1(x))
$$
satisfying
\begin{equation}\label{131}
\pr_1(a,b)\equiv a,\quad\pr_2(a,b)\equiv b
\end{equation}
for all $a:A$ and all $b:B(a)$.

\nn(b) We also assume that, for all type family $B:A\to\U$ we have a dependent function 
$$
\uniq_{\sum_{a:A}B(a)}:\prod_{x:\sum_{a:A}B(a)}(\pr_1(x),\pr_2(x))=x
$$ 
such that 
\begin{equation}\label{132}
\uniq_{\sum_{a:A}B(a)}(a,b)\equiv\refl_{(a,b)}
\end{equation}
for all $a:A$ and all $b:B(a)$. 

\nn(c) We define
$$
\ind_{\sum_{a:A}B(a)} : \prod_{C:\sum_{a:A}B(a)\to\U} 
\left(\prod_{a:A}\prod_{b:B(a)} C((a,b))\right) 
\to \prod_{x:\sum_{a:A}B(a)} C(x)
$$
thanks to the transport principle, which is indeed a concept from Chapter~2, by
\begin{equation}\label{133}
\ind_{\sum_{a:A}B(a)}(C,g,x):
\equiv\uniq_{\sum_{a:A}B(a)}(x)_*\Big(g(\pr_1(x))(\pr_2(x))\Big).
\end{equation}
(d) We must prove 
$$
\ind_{\sum_{a:A}B(a)}(C,g,(a,b))\equiv g(a)(b)
$$
for all $a:A$ and all $b:B(a)$. But this follows from \eqref{131}, \eqref{132} and \eqref{133}.

%%

\subsection{Exercise 1.5}

\emph{Statement.} Show that if we define $A+B:\equiv\sum_{x:\two}\rec_\two(\U,A,B,x)$, then we can give a definition of $\ind_{A+B}$ for which the definitional equalities stated in \S1.7 hold.

\nn\emph{Solution.} We define $\inl:A\to A+B$ by $\inl(a):\equiv(0_\two,a)$, and we define $\inr$ similarly. Let $C:A+B\to\U$ be given, and put 
$$
A':\equiv\prod_{a:A}C(\inl(a)),\quad B':\equiv\prod_{b:B}C(\inr(b)).
$$
We must define 
$$
\ind_{A+B}:\prod_{C:A+B\to\U}A'\to B'\to\prod_{x:A+B}C(x).
$$ 
Let $g_0:A',g_1:B'$ be given. We must define 
$$
\ind_{A+B}(C,g_0,g_1):\prod_{x:A+B}C(x).
$$ 
Set $T:\equiv\rec_\two(\U,A,B):\two\to\U$. We define $D:\two\to\U$ by 
$$
D(n):\equiv\prod_{u:T(n)}C((n,u)).
$$ 
Note that $D(0_\two)\equiv A'$ and $D(1_\two)\equiv B'$. Recall that 
$$
\ind_\two(D):D(0_\two)\to D(1_\two)\to\prod_{n:\two}D(n).
$$ 
In particular we have 
$$
\ind_\two(D,g_0,g_1):\prod_{n:\two}\ \prod_{u:T(n)}C((n,u)).
$$ 
Since 
$$
\ind_{\sum_{n:\two}T(n)}(C):\left(\prod_{n:\two}\ \prod_{u:T(n)}C((n,u))\right)\to\prod_{x:A+B}C(x),
$$ 
we can put 
$$
\ind_{A+B}(C,g_0,g_1):\equiv\ind_{\sum_{n:\two}T(n)}(C,\ind_\two(D,g_0,g_1)).
$$ 
We must check 
\begin{equation}\label{15a}
\ind_{A+B}(C,g_0,g_1,(0_\two,a))\equiv g_0(a),
\end{equation}
\begin{equation}\label{15b}
\ind_{A+B}(C,g_0,g_1,(1_\two,b))\equiv g_1(b).
\end{equation} 
We have 
\begin{align*}
\ind_{A+B}(C,g_0,g_1,(0_\two,a))&\equiv\ind_{\sum_{n:\two}T(n)}(C,\ind_\two(D,g_0,g_1)\\ 
&\equiv\ind_\two(D,g_0,g_1)(0_\two)(a)\\ 
&\equiv g_0(a),
\end{align*}
the three definitional equalities following respectively from the definitions of the dependent functions
$$
\ind_{A+B},\quad\ind_{\sum_{n:\two}T(n)},\quad\ind_\two.
$$ 
This proves \eqref{15a}. The proof of \eqref{15b} is similar.

%%

\subsection{Exercise 1.6}

\emph{Statement.} Show that if we define $A\times B:\equiv\prod_{x:\two}\rec_\two(\U,A,B,x)$, then we can give a definition of  $\ind_{A\times B}$ for which the definitional equalities stated in \S1.5 hold propositionally (i.e. using equality types). \emph{(This requires the function extensionality axiom, which is introduced in \S2.9.)}

\nn\emph{Solution.} As above put $T:\equiv\rec_\two(\U,A,B):\two\to\U$, so that $A\times B:\equiv\prod_{n:\two}T(n)$, and 
$$
\ind_\two(T):A\to B\to A\times B.
$$ 
For $a:A,b:B$ we abbreviate $\ind_\two(T,a,b)$ by $(a,b)$; in particular we have 
$$
(a,b):A\times B,\quad(a,b)(0_\two)\equiv a,\quad(a,b)(1_\two)\equiv b.
$$ 
Let $C:A\times B\to\U$. We must define 
$$
\ind_{A\times B}(C):\left(\prod_{a:A}\prod_{b:B}C((a,b))\right)\to\prod_{u:A\times B}C(u).
$$ 
Define $D:\two\to\U$ by 
$$
D(n):\equiv\Big(\big(u(0_\two),u(1_\two)\big)(n)=u(n)\Big)
$$ 
and recall that 
$$
\ind_\two(D):D(0_\two)\to D(1_\two)\to\prod_{n\in\two}D(n)
$$ 
and that 
$$
\fu:\prod_{n\in\two}D(n)\to\Big(\big(u(0_\two),u(1_\two)\big)=u\Big).
$$
We get 
$$
\alpha:\equiv\ind_\two(D,\refl_{u(0_\two)},\refl_{u(1_\two)}):\prod_{n\in\two}D(n),\quad\fu(\alpha):\Big(\big(u(0_\two),u(1_\two)\big)=u\Big),
$$
$$
\fu(\alpha)_*:C((u(0_\two),u(1_\two)))\to C(u).
$$
In particular we can set
$$
\ind_{A\times B}(C,g,u):\equiv\fu(\alpha)_*(g(u(0_\two))(g(u(1_\two)).
$$

To show that the definitional equalities stated in \S1.5 hold propositionally, we assume $u\equiv(a,b)$. In particular we have 
$$
\alpha:\prod_{n\in\two}\Big((a,b)(n)=(a,b)(n)\Big).
$$ 
It is easy to prove $\alpha(n)=\refl_{(a,b)(n)}$ by induction. This gives 
$$
\ind_{A\times B}(C,g,(a,b))=g(a)(b),
$$ 
as required.

%%

\subsection{Exercise 1.8}

\emph{Statement.} Define multiplication and exponentiation using $\rec_\N$. Verify that $(\N,+,0,\times,1)$ is a semiring using only $\ind_\N$. You will probably also need to use symmetry and transitivity of equality, Lemmas 2.1.1 and 2.1.2.

\nn\emph{Solution.} We put
$$
\msf{mult}:\equiv\rec_\N(\N\to\N,\la m.0,\la m.\la g.\la n.m+g(m)),
$$
$$
\msf{exp}:\equiv\rec_\N(\N\to\N,\la m.1,\la m.\la g.\la n.mg(m)).
$$ 
We omit the verification of the fact that $(\N,+,0,\times,1)$ is a semiring.

%%

\subsection{Exercise 1.10}

\emph{Statement.} Show that the Ackermann function $\ack :\N\to\N\to\N$ is definable using only $\rec_\N$ satisfying the following equations:
\begin{align*}
\ack(0,n)&\equiv\su(n),\\
\ack(\su(m),0)&\equiv\ack(m,1),\\
\ack(\su(m),\su(n))&\equiv\ack(m,\ack(\su(m),n)).
\end{align*}

\nn\emph{Solution.} I have used John Dougherty's text 

\nn\href{https://github.com/jdoughertyii/hott-exercises}{https://github.com/jdoughertyii/hott-exercises}

We try to solve Equation 
\begin{equation}\label{ack1}
\ack:\equiv\rec_\N(C,c_0,c_s)
\end{equation}
for $C:\U,c_0:C,c_s:\N\to C\to C$. We get $C:\equiv(\N\to\N)$, and evaluation at 0 gives $c_0\equiv\su$. Let $i:\N,f:\N\to\N$. It suffices to solve Equation 
\begin{equation}\label{ack2}
c_s(i,f):\equiv\rec_\N(D,d_0(i,f),d_s(i,f))
\end{equation}
for $D:\U,d_0(i,f):D,d_s(i,f):\N\to D\to D$. We get $D:\equiv\N$. We have
\begin{align*}
\ack(\su(n))&\equiv\rec_\N(C,\su,c_s,\su(m))\\
&\equiv c_s(m,\rec_\N(C,\su,c_s,m))\\
&\equiv c_s(m,\ack(m))\\
&\equiv\rec_\N(\N,d_0(m,\ack(m)),d_s(m,\ack(m))),
\end{align*}
and evaluation at 0 yields $d_0(m,\ack(m))\equiv\ack(m)(1)$, prompting us to set $$d_0(i,f):\equiv f(1).$$ We have 
\begin{align*}
\ack(m)\big(\ack(\su(m),n)\big)&\equiv\ack\big(m,\ack(\su(m),n)\big)\\ 
&\equiv\ack(\su(m),\su(n))\\ 
&\equiv\rec_\N\big(\N,\ack(m,1),d_s(m,\ack(m)),\su(n)\big)\\
&\equiv d_s\big(m,\ack(m)\big)\big(n,\ack(\su(m),n)\big),
\end{align*}
prompting us to set $d_s(i,f)(x,y):\equiv f(y)$. 

Abbreviating $d_s(i,f)$ by $f'$, we get 
$$
\ack:\equiv\rec_\N(\N\to\N,\su,c_s)
$$ 
with 
$$ 
c_s(i,f)\equiv\rec_\N(\N,f(1),f')
$$ 
for 
$$ 
i:\N,\quad f:\N\to\N,\quad f':\N\to\N\to\N,\quad f'(x,y):\equiv f(y).
$$

%%

\subsection{Exercise 1.13}

\emph{Statement.} Using propositions-as-types, derive the double negation of the principle of excluded middle, i.e. prove \emph{not (not ($P$ or not $P$))}.

\nn\emph{Solution.} Here is a slightly stronger statement: For any types $A,B,C$ the types

(a) $\big((A+B)\to C\big)\to\big((A\to C)\times(B\to C)\big)$,

(b) $\big((A\to C)\times(B\to C)\big)\to\big((A+B)\to C\big)$,

(c) $(A\to B)\to A\to B$,

(d) $\Big(\big(A+(A\to B)\big)\to B\Big)\to\Big((A\to B)\times\big((A\to B)\to B\big)\Big)$, 

(e) $\Big((A\to B)\times\big((A\to B)\to B\big)\Big)\to B$,

(f) $\Big(\big(A+(A\to B)\big)\to B\Big)\to B$

\nn are inhabited. The proof that (a), (b), (c) are inhabited is left to the reader. The fact that (a) and (c) are inhabited implies that (d) and (e), and thus (f), are inhabited. Putting $B:\equiv\mbf0$ in (f) gives the desired result.

%%

\section{Chapter 2}

\subsection{Proof of Theorem 2.7.2}

The map 
\begin{equation}\label{272}
(w=w')\to\sum_{p:\pr_1(w)=\pr_1(w')}p_*(\pr_2(w))=\pr_2(w')
\end{equation}
can also be defined by the formula 
$$
r\mapsto(\ap_{\pr_1}(r),\apd_{\pr_2}(r)).
$$

%%

\subsection{Comment after Corollary 2.7.3}

We write 
$$
\pa:\left(\sum_{p:\pr_1w=\pr_1w'}(\pr_*\pr_2w=\pr_2w')\right)\to(w=w').
$$ 
for ``the'' inverse of \eqref{272}. We then have the propositional computation rules 
$$
\ap_{\pr_1}(\pa(p,q))=p,
$$
$$
\apd_{\pr_2}(\pa(p,q))=q
$$
for $(p,q):\sum_{p:\pr_1(w)=\pr_1(w')}p_*(\pr_2(w))=\pr_2(w')$, and the propositional uniqueness principle 
$$
r=\pa(\ap_{\pr_1}(r),\apd_{\pr_2}(r))
$$ 
for $r:w=w'$.

%%

\subsection{Theorem 2.7.4}\label{274}

We wish to rewrite the last display of Theorem 2.7.4 in a slightly more explicit way. We abbreviate $\sum_{u:P(x)}Q(x,u)$ by $Q'(x)$, and $\tr$ by $\msf t$; and we write $\pa_P$ instead of $\pa$ to emphasize the fact that this operation is taken with respect to the type family $P:A\to\U$. Here is the rewriting:
$$
\msf t^{Q'}(p,(u,z))=\Bigg(\msf t^P(p,u),\msf t^Q\bigg(\pa_P\Big(p,\refl_{\msf t^P(p,u)}\Big),z\bigg)\Bigg).
$$ 
The key step to check that the above equality is well-typed is the judgment 
$$
\pa_P\Big(p,\refl_{\msf t^P(p,u)}\Big):(x,u)=_{\sum_{x:A}P(x)}\big(y,\msf t^P(p,u)\big).
$$

%%

\subsection{Lemma 2.9.7}

Recall the statement of the Lemma: Given type families $A:X\to\U$ and $B:\prod_{x:X}A(x)\to\U$ and $p=x=y$, and also $f:\prod_{a:A(x)}B(x,a)$ and $g:\prod_{a:A(y)}B(y,a)$, we have an equivalence 
$$
\big(p_*(f)=g\big)\simeq\prod_{a:A(x)}\tr^{\widehat B}\Big(\pa(p,\refl_{p_*(a)}),f(a)\Big)=g(p_*(a)).
$$ 

It is written, after the Lemma: ``We leave it to the reader to prove this and to formulate a suitable computation rule''. I think this means the following:

If $q:p_*(f)=g$ corresponds unde this equivalence to $\widehat q$, then for $a:A(x)$, the path 
$$
\msf{happly}(q,p_*(x)):(p_*(f))(p_*(a))=g(p_*(a))
$$ 
is equal to the composite 
$$
\big(p_*(f)\big)\big(p_*(a)\big)=
\tr^{\widehat B}\bigg(\pa\left(p^{-1},\refl_{p^{-1}_*(p_*(a))}\right)^{-1},f\Big(p^{-1}_*\big(p_*(a)\big)\Big)\bigg)
$$
$$
=\tr^{\widehat B}\Big(\pa\left(p,\refl_{p_*(a)}\right),f(a)\Big)=g\big(p_*(a)\big),
$$ 
where the first path is given by the display preceding (2.9.5), and the last path is given by $\widehat q$. Note the judgments
$$
\pa\left(p^{-1},\refl_{p^{-1}_*(p_*(a))}\right):\big(y,p_*(a)\big)=_{\sum_{x:X}A(x)}\Big(x,p^{-1}_*\big(p_*(a)\big)\Big),
$$ 
$$
\pa\left(p,\refl_{p_*(a)}\right):(x,a)=_{\sum_{x:X}A(x)}\big(y,p_*(a)\big).
$$

%%

\subsection{Display preceding (2.9.5)}

Note that $p^{-1}_*(a)$ and $\tr^A(p^{-1},a)$ designate the same object, and that we have 
$$
\pa(p^{-1},\refl_{p^{-1}_*(a)}):(x_1,p^{-1}_*(a))=_{\sum_{x:X}A(x)}(x_2,a).
$$

%%

\subsection{Proof of Theorem 2.11.1}

Let $f:A\to B$ be an equivalence, and let $a,a':A$. We must show that 
$$
\ap_f:(a=a')\to (fa=fa')
$$ 
is an equivalence.

Step 1. (This step is the the same as in the book; I spell it out for the reader's convenience.) Let $g:B\to A$ be a quasi-inverse to $f$, let $\beta:g\circ f=\id_A$, and define 
$$
\varphi:(gfa=gfa')\to(a=a')\quad\text{by}\quad\varphi(q):\equiv\beta_a^{-1}\cdot q\cdot\beta_{a'}.
$$ 
Note, as in the book, that the equality $\varphi\circ\ap_g\circ\ap_f=\id_{a=a'}$ follows from the functoriality of $\ap$ and the naturality of homotopies, Lemmas 2.2.2 and 2.4.3. (Here $\ap_g:(fa=fa')\to (gfa=gfa')$.)

Step 2. Since $\varphi$ is an equivalence (see Example 2.4.8 in the book), $\ap_g\circ\ap_f$ is also an equivalence, and so is, by symmetry, $\ap_f\circ\ap_g$. This implies that $\ap_f$ and $\ap_g$ are equivalences.

%old: https://docs.google.com/document/d/1OvMAEN0uvE18rTCHAmZAIYKiILQ_FNT5JJqNH3HH760/edit

%%

\subsection{Double recursion in \S2.13}

The statement below is used several times in Section 2.13.

For any type $C$, any maps 
$$
g,h:\N\to C,\quad i:\N\to\N\to C\to C,
$$ 
there is a map $f:\N\to\N\to C$ satisfying 
$$
f(0)\equiv g,\quad f(\su(m),0)\equiv h(m),\quad f(\su(m),\su(n))\equiv i(m,n,f(m,n))
$$ 
for all $m,n:\N$.

Indeed, it suffices to put 
$$
f:\equiv\rec_\N(\N\to C,g,d_s),
$$ 
where 
$$
d_s:\N\to(\N\to C)\to(\N\to C)
$$ 
is defined by 
$$
d_s(m,x):\equiv\rec_\N(C,h(m),c_s),
$$ 
where 
$$
c_s:\N\to C\to C
$$ 
is defined by 
$$
c_s(n,y):\equiv i(m,n,x(n)).
$$ 
One can also define $f$ by the single formula
$$
f\equiv\rec_\N\Bigg(\N\to C,g,m\mapsto x\mapsto\rec_\N\bigg(C,h(m),n\mapsto y\mapsto i\big(m,n,x(n)\big)\bigg)\Bigg).
$$

%%

\subsection{Section 2.14.1}

\subsubsection{Use of Theorem 2.7.4}

We apply Theorem 2.7.4 by setting $A\de\U,P(A)\de(A\to A\to A)$ for $A:\U$, 
$$
Q:\left(\sum_{A:\U}(A\to A\to A)\right)\to\U,\quad Q(A,m)\de(m(x,m(y,z))=m(m(x,y),z)).
$$ 
As \S\ref{274} we put 
$$
Q'(A)\de(m(x,m(y,z))=m(m(x,y),z))
$$ 
for $A:\U$. In the notation of \S\ref{274} the last display of Theorem 2.7.4 now reads 
$$
\msf t^{Q'}(p,(m,a))=\Bigg(\msf t^P(p,m),\msf t^Q\bigg(\pa_P\Big(p,\refl_{\msf t^P(p,m)}\Big),a\bigg)\Bigg)
$$ 
with $p\de\msf{ua}(e)$.

\subsubsection{A general comment}

The main purpose of \S2.14.1 is to obtain the formulas
$$
m'(b_1,b_2)=e(m(e^{-1}(b_1),e^{-1}(b_2)))
$$ 
and
\begin{equation*}
  \begin{aligned}
    m'(m'(b_1,b_2),b_3)
    &= e(m(e^{-1}(m'(b_1,b_2)),e^{-1}(b_3))) \\
    &= e(m(e^{-1}(e(m(e^{-1}(b_1),e^{-1}(b_2)))),e^{-1}(b_3))) \\
    &= e(m(m(e^{-1}(b_1),e^{-1}(b_2)),e^{-1}(b_3))) \\
    &= e(m(e^{-1}(b_1),m(e^{-1}(b_2),e^{-1}(b_3)))) \\
    &= e(m(e^{-1}(b_1),e^{-1}(e(m(e^{-1}(b_2),e^{-1}(b_3)))))) \\
    &= e(m(e^{-1}(b_1),e^{-1}(m'(b_2,b_3)))) \\
    &= m'(b_1,m'(b_2,b_3)).
\end{aligned}
\end{equation*}
(We refer the reader to the book for the precise notation. The above chain of equalities is preceded by the sentence ``Moreover, though we do not show the proof, one can calculate that the induced proof that $m'$ is associative \dots\ is equal to a function sending $b_1,b_2,b_3:B$ to a path given by the following steps''. The main ingredient is Theorem 2.7.4.)

It seems to me one could argue as follows: state the above two formulas, check that they are well-typed, check that they hold when $A\ee B$ and $p$ is reflexivity, conclude by path induction that they hold in general.

%%

\subsection{Exercise 2.7}

\emph{Statement.} State and prove a generalization of Theorem 2.6.5 from cartesian products to $\Sigma$-types. 

\nn\emph{Solution.} We denote respectively by $\alpha$ and $\beta$ the dependent functions $f$ and $g$ in the proof of Theorem 2.7.2. Note that we have 
$$
\beta(z,z,\refl_{\pr_2(f(z))})\equiv\refl_z.
$$

Let 
$$
B:A\to\U,\quad B':A'\to\U,\quad g:A\to A',\quad h:\prod_{a:A}B(a)\to B'(g(a)).
$$ 
Cleary, there is a map 
$$
f:\sum_{a:A}B(a)\to\sum_{a':A'}B'(a')
$$ 
satisfying $f(a,b)\equiv (g(a),h(a,b))$ for all $a:A$ and all $b:B(a)$. 

By path induction, we get a family of paths 
$$
\gamma(z,w,p):f(p)=\beta\Big(f(z),f(w),\alpha\big(f(z),f(w),f(p)\big)\Big),
$$ 
where $z,w:\sum_{a:A}B(a)$ and $p:z=w$, satisfying 
$$
\gamma(z,z,\refl_z)\equiv\refl_{\refl_{f(z)}}.
$$

%%

\subsection{Exercise 2.14}

\emph{Statement.} Suppose we add to type theory the \emph{equality reflection rule} which says that if there is an element $p:x=y$, then in fact $x:\equiv y$. Prove that for any $p:x=x$ we have $p:\equiv\refl_x$. (This implies that every type is a \emph{set} in the sense to be introduced in \S3.1; see \S7.2.)

\nn\emph{Solution.} Given $x$ we construct $f(y,p):p=\refl_x$ for $p:x=y$ by based path induction. Note that $p=\refl_x$ is a well-defined type because $p:x=y$ (our current assumption) implies $y\equiv x$ by the equality reflection rule.

%%

\section{Chapter 3}

\subsection{Proof of Lemma 3.1.8}\label{318}

Recall the statement: 

If $A$ is a set (that is, $\msf{isSet}(A)$ is inhabited), then $A$ is a 1-type. 

Here is a slightly different wording of the proof:

Suppose $f:\msf{isSet}(A)$ and let $x,y:A$. For any $p,q:x=y$ we have $f(p,q):p=q$. For $q':x=y$ and $r:q=q'$ we prove 
$$
r=f(p,q)^{-1}\cdot f(p,q')
$$ 
by path induction on $r$.

%%

\subsection{Theorem 3.2.2}

The proof of Theorem 3.2.2 shows the following:

If $P:\U\to\U$ is a type family over $\U$ such that $P(A)$ is a mere proposition for all $A:\U$, the it is not the case that for all $A:\U$ we have $P(A)\to A$.

%%

\subsection{Proof of Lemma 3.3.4}

Recall the statement: Every mere proposition is a set. In the proof of Lemma 3.1.8 in \S\ref{318} we derived the conclusion that $x=y$ is a set using only the assumption that $x=y$ is a mere proposition.

%%

\subsection{Proof of Lemma 3.11.4} 

Recall the statement: 

For any type $A$, the type $\msf{isContr}(A)$ is a mere proposition.

Here is a minor variant of the proof:

Let $c,c:\msf{isContr}(A)$. Since $A$ is contractible (by $c$ or $c'$), Lemma 3.11.3 implies $A=\mbf1$, and thus 
$$
\msf{isContr}(A)=\left(\sum_{a:\mbf1}\prod_{x:\mbf1}a=x\right)=\left(\sum_{a:\mbf1}\prod_{x:\mbf1}\mbf1\right)=\left(\sum_{a:\mbf1}\mbf1\right)=\mbf1.
$$

%%

\subsection{Proof of Lemma 3.11.8} 

Recall the statement: 

For any $A$ and any $a:A$, the type $\sum_{x:A}a=x$ is contractible with center $(a,\refl_a)$. 

Here is a minor variant of the proof:

We prove $(x,p)=(a,\refl_a)$ for any $(x,p):\sum_{x:A}a=x$ by based path induction.

%%

\subsection{Exercise 3.6}

\emph{Statement.} Show that if $A$ is a mere proposition, then so is $A+\neg A$.

\nn\emph{Proof.} For $a_1,a_2:A$ we have $a_1=a_2$ because $A$ is a mere proposition, and thus $\msf{inl}(a_1)=\msf{inl}(a_2)$. For $a_1',a_2':\neg A$ we have $a_1'=a_2'$ because $\neg B$ is a mere proposition for any type $B$, and thus $\msf{inr}(a_1')=\msf{inr}(a_2')$. Let $a:A$ and $a':\neg A$. We must show $\msf{inl}(a)=\msf{inr}(a')$. Let $f:\mbf0\to(\msf{inl}(a)=\msf{inr}(a'))$, and note that $f(a'(a)):\msf{inl}(a)=\msf{inr}(a')$.

%%

\subsection{Exercise 3.7}

We assume that $A$ and $B$ are mere propositions, and that $\neg(A\times B)$ is inhabited. We claim that $A+B$ is a mere proposition. It suffices to prove $x=y$ in the following cases:

(a) $x=\msf{inl}(a),\ y=\msf{inl}(a')$,

(b) $x=\msf{inr}(b),\ y=\msf{inr}(b')$,

(c) $x=\msf{inl}(a),\ y=\msf{inr}(b)$.

\nn We leave Cases (a) and (b) to the reader, and take up Case~(c). Let $f:A\times B\to\mbf0$ and $g:\mbf0\to(\msf{inl}(a)=\msf{inr}(b))$. We get $g(f(a,b)):\msf{inl}(a)=\msf{inr}(b)$.

%%

\subsection{Exercise 3.9}

We admit the Law of Excluded Middle $\msf{LEM}$ defined in (3.4.1) by 
$$
\msf{LEM}:\prod_{A:\U}\msf{isProp}(A)\to(A+\neg A),
$$ 
and we want to prove 
\begin{equation}\label{e39}
\sum_{A:\U}\msf{isProp}(A)\simeq\mbf2.
\end{equation}

For any type $A$ we put 
$$
P(A):\equiv\msf{isProp}(A),\quad Q_1(A):\equiv(\mbf1\simeq A),
$$
$$
Q_0(A):\equiv(\mbf0\simeq A),\quad Q(A):\equiv Q_1(A)+Q_0(A).
$$ 

We claim

\nn(a) For any type $A$ there is a map $f_a:P(A)\times A\to Q_1(A)$. This follows from Lemma 3.3.2. (More precisely, we define $f_a$ as the map given by Lemma 3.3.2.)

\nn(b) For any type $A$ there is a map $f_b:P(A)\times\neg A\to Q_0(A)$.

\nn(c) For any types $A,B,C$ there is an equivalence $A\times(B+C)\simeq(A\times B)+(A\times C)$.

\nn(d) For any type $A$ there is a map $f_d:Q(A)\to P(A)$.

\nn(e) For any type $A$ there are maps 
$$
\begin{matrix}
f_e:P(A)&\to &P(A)\times(A+\neg A)\\ 
        &g_e:&P(A)\times(A+\neg A)&\to &(P(A)\times A)+(P(A)\times\neg A)\\ 
        &    &                    &h_e:&(P(A)\times A)+(P(A)\times\neg A)&\to Q(A)
\end{matrix}
$$ 
such that $f_e(p):\equiv(p,\msf{LEM}(A,p))$, $g_e$ is given by (c), and $h_e$ is given by (a) and (b). Let $i_e:P(A)\to Q(A)$ be the composition $h_e\circ g_e\circ f_e$.

\nn(f) For any type $A$ there is a map $f_f:Q(A)\to P(Q(A))$.

\nn(g) The maps $f_d$ and $i_e$ are quasi-inverse.

\nn(h) For any type families $C,D:A\to\U$, there is an equivalence 
$$
\sum_{a:A}C(a)+D(a)\simeq\left(\sum_{a:A}C(a)\right)+\sum_{a:A}D(a).
$$
\nn(i) The types $\sum_{A:\U}Q_1(A)$ and $\sum_{A:\U}Q_0(A)$ are contractible (with obvious centers).

\nn(j) There are equivalences 
$$
\sum_{A:\U}P(A)\simeq\sum_{A:\U}Q(A)\simeq\left(\sum_{A:\U}Q_1(A)\right)+\sum_{A:\U}Q_0(A)\simeq\mbf1+\mbf1,
$$ 
following respectively from (g), (h) and (i). This implies \eqref{e39}.

Since we have $P(P(A))$ by Lemma 3.3.5 and $P(Q(A))$ by (f), Statement~(g) follows from (d), (e) and Lemma 3.3.3. The other claims are left to the reader.

%%

\subsection{Exercise 3.18}

\emph{Statement.} Show that the law of excluded middle (3.4.1) and the law of double negation (3.4.2) are logically equivalent.

\nn\emph{Proof.} To prove that the law of excluded middle implies the law of double negation, we assume that the types 
$$
P(A),\quad A+\neg A,\quad \neg\neg A
$$ 
are inhabited, and we show that so is $A$ as follows. Let $x:A+\neg A$. If $x\ee\msf{inl}(a)$ for some $a:A$ we are done. If $x\ee\msf{inr}(a')$ for some $a':\neg A$, we let $f:\mbf0\to A$ and $a'':\neg\neg A$, and get $f(a''(a')):A$. 

To prove that the law of double negation implies the law of excluded middle, we let $A$ be a mere proposition, and we show that $A+\neg A$ is inhabited as follows. By exercise 3.6, $A+\neg A$ is also a mere proposition, and thus there is a map $\neg\neg(A+\neg A)\to A+\neg A$. Hence it suffices to check that $\neg\neg(A+\neg A)$ is inhabited. To this end, we define $x'':\neg\neg(A+\neg A)$ by $x''(x')\de(x'\circ\msf{inr})(x'\circ\msf{inl})$.

%%

\section{Chapter 4}

\subsection{Proof of Lemma 4.1.2}

The claim

\nn ``It remains to show that $h$ is identified with $h'$ when transported along this equality, which by transport in identity types and function types, reduces to showing 
$$
h(s)=h(p)\cdot h'(p)^{-1}\cdot h'(s)
$$ 
for any $s:a=x$''

\nn in the proof of Lemma 4.1.2 in the HoTT Book follows immediately from Theorem 2.7.2 and the Lemma below, which is easily proved by path induction:

\nn \textbf{Lemma.} Let $A$ be a type; let $a,x:A$; let $q:a=a$; let $P:(x=x)\to\U$ be defined by 
$$
P(r):\equiv\prod_{s:a=x}(r=s^{-1}\cdot q\cdot s);
$$ 
let $r,r':x=x,\ t:r=r',\ h:P(r),\ s:a=x$. Then 
$$
\oo{transport}^P(t,h)(s)=t^{-1}\cdot h(s).
$$ 

To complete the proof of Lemma 4.1.2, we set $f(x):\ee\msf{pr}_1(k(x))$ with $k:\prod_{x:A}B(x)$.
%https://github.com/HoTT/book/blob/master/equivalences.tex#L107

%%

%\nn$\bullet$ Proof of Theorem 4.1.3.

%The fact that $\two\simeq\two$ is a set follows from univalence and Examples 3.1.2 and 3.1.5.

%%

\subsection{Proof of Theorem 4.7.6}

Let us check Equivalence $(*)$ in the proof of Theorem 4.7.6: For $a:A$ and $p:a=x$ put 
$$
Q(a,p):\equiv\sum_{u:P(a)}p_*(f(a,u))=v.
$$ 
We claim 
$$
\sum_{a:A}\sum_{p:a=x}Q(a,p)\overset{(\text a)}{\simeq}
\sum_{q:\sum_{a:A}(a=x)}Q(q)\overset{(\text b)}{\simeq}
Q(x,\refl_x).
$$
Equivalence (a) follows from Exercise 2.10. As Lemma 3.11.8 implies that $$\sum_{a:A}\ (a=x)$$ is contractible with center $(x,\refl_x)$, Equivalence (b) follows from Lemma 3.11.9 (ii). 

%%

\subsection{Proof of Theorem 4.8.3}

Here are some details about the last sentence of the proof of Theorem 4.8.3:

Firstly we rewrite (2.9.4) as follows. Abbreviating transport by $t$ we have 
\begin{equation}\label{2.9.4}
t^{A\to B}(p,f,a_2)=t^B(p,f(t^A(p^{-1},x)))
\end{equation}
for $p:x_1=_Xx_2,\ f:A(x_1)\to B(x_1),\ a_2:A(x_2)$. 

Now let us move to last sentence of the proof of Theorem 4.8.3. Put
$$
F:\equiv\sum_{b:B}\oo{fib}_f(b),
$$ 
and let $p_1:F\to B$ be the first projection. We must show 
\begin{equation}\label{2}
(F,p_1)=_{\sum_{X:\U}X\to B}(A,f).
\end{equation} 
We have $e:F\simeq A$. Put $q:\equiv\ua(e)$. We have $q:F=A$. We claim 
\begin{equation}\label{3}
q_*(p_1)=f.
\end{equation} 
By Theorem 2.7.2, \eqref{3} will imply \eqref{2}. For all $X:\U$ set $I(X)\equiv X,\ C(X)\equiv B$. Then \eqref{3} becomes, in the notation of (2.9.4), 
$$
t^{I\to C}(q,p_1)=f.
$$ 
Let $a:A$. We must show 
$$
t^{I\to C}(q,p_1,a)=f(a).
$$ 
We get 
$$
t^{I\to C}(q,p_1,a)\overset{\text{(a)}}=t^C(q,p_1(t^I(q^{-1},a)))\overset{\text{(b)}}=p_1(e^{-1}(a))\overset{\text{(c)}}=f(a),
$$ 
where (a) follows from \eqref{2.9.4}, (b) follows from the computation rule for univalent stated right after Remark 2.10.4, and (c) follows from the definition of $e^{-1}$.

%%

\subsection{Proof of Theorem 4.8.4}

The proof of Theorem 4.8.4 uses the following lemma: For $A:\U$ we have 
$$
A\simeq\sum_{X:\U}\ (X=A)\times X.
$$
More precisely, we shall define maps 
$$
A\rightleftarrows\sum_{X:\U}\ (X=A)\times X
$$ 
and check that they are mutual quasi-inverses. To $a:A$ we attach $(A,\refl_A,a)$, and to $(B,p,b)$ we attach $t^{X\mapsto X}(p,b)$. Here and in the sequel we write $t$ for "transport". We have 
$$
a\mapsto(A,\refl_A,a)\mapsto t^{X\mapsto X}(\refl_A,a)\equiv a.
$$ 
We have 
$$
(B,p,b)\mapsto t^{X\mapsto X}(p,b)\mapsto(A,\refl_A,t^{X\mapsto X}(p,b)),
$$ 
and we must show 
$$
(B,p,b)=(A,\refl_A,t^{X\mapsto X}(p,b)).
$$ 
By Theorem 2.7.2 it suffices to verify 
$$
t^{X\mapsto (X=A)\times X}(p,(p,b))=(\refl_A,t^{X\mapsto X}(p,b)).
$$ 
By Theorem 2.6.4 it suffices to prove 
$$
t^{X\mapsto (X=A)}(p,p)=\refl_A.
$$ 
But this follows from Lemma 2.11.2.

%%

\subsection{Exercise 4.6 (iii)}

\emph{Statement.} For $A,B:\mathcal U$, define
$$
\mathsf{idtoqinv}_{A,B}:(A=B)\to\sum_{f:A\to B}\mathsf{qinv}(f)
$$
by path induction in the obvious way. Let $\mathsf{qinv}$-$\mathsf{univalence}$ denote the modified form of the univalence axiom which asserts that for all $A,B:\mathcal U$ the function $\mathsf{idtoqinv}_{A,B}$ has a quasi-inverse.

\nn(i) Show that $\mathsf{qinv}$-$\mathsf{univalence}$ can be used instead of univalence in the proof of function extensionality in $\S$4.9.

\nn(ii) Show that $\mathsf{qinv}$-$\mathsf{univalence}$ can be used instead of univalence in the proof of Theorem 4.1.3.

\nn(iii) Show that $\mathsf{qinv}$-$\mathsf{univalence}$ is inconsistent (i.e. allows construction of an inhabitant of **0**). Thus, the use of a "good" version of $\mathsf{isequiv}$ is essential in the statement of univalence.

\nn\emph{Solution.} In view of Theorem 4.1.3 it suffices to show that, for any map $f:A\to B$, the type $\mathsf{qinv}(f)$ is a mere proposition. 

For any types $A$ and $B$ we put 
$$
(A\simeq B):\equiv\sum_{f:A\to B}\mathsf{ishae}(f),\quad(A\backsimeq B):\equiv\sum_{f:A\to B}\mathsf{qinv}(f).
$$ 
(Recall that $\mathsf{ishae}(f)$ stands for "$f$ is a half-adjoint equivalence".) By Theorem 4.2.3 and the comment preceding it, there are dependent functions 
$$
i:\prod_{A,B:\mathcal U}\prod_{f:A\to B}\mathsf{ishae}(f)\to\mathsf{qinv}(f),\quad p:\prod_{A,B:\mathcal U}\prod_{f:A\to B}\mathsf{qinv}(f)\to\mathsf{ishae}(f).
$$ 
For all $A,B:\mathcal U$ let $e(A,B):(A=B)\to(A\backsimeq B)$ be the natural map (which we assume to admit a quasi-inverse).

Claim: if $f:A\to B$ and $x:\mathsf{qinv}(f)$, then $i(A,B,f,p(A,B,f,x))=x$.
 
Since $(f,x):A\backsimeq B$, we can assume by $\mathsf{qinv}$-univalence and path induction that 
$$
B\equiv A,\quad f\equiv\mathsf{id}_A,\quad x\equiv e(A,A,\mathsf{refl}_A),
$$ 
and the claim follows easily from the definition of $i,p$ and $e$.

For $f:A\to B$ and $x,y:\mathsf{qinv}(f)$ we have $p(A,B,f,x)=p(A,B,f,y)$ because $\mathsf{ishae}(f)$ is a mere proposition, and the claim implies $x=y$, as required.

%%

\section{Chapter 6}

\subsection{Display (6.2.2)}

In the setting of Lemma 2.3.4, we have 
$$
\msf{adp}_f(p):f(x)=^P_pf(y).
$$

%%

\subsection{Proof of Corollary 6.4.3}

Recall the following facts: 

A type $A$ is a set if and only if $x=y$ is a mere proposition for all $x,y:A$ (observation stated just before Lemma 3.3.4). 

A mere proposition is a set (Lemma 3.3.4).

A type is contractible if and only if it is an inhabited mere proposition (Lemma 3.11.3). 

The proof of Corollary 6.4.3 uses the following fact:

Let $A$ and $B$ be types, let $f,g:A\to B$, let $u:\mathsf{isequiv}(f),\ u:\mathsf{isequiv}(g)$, so that $(f,u),(g,v):A\simeq B$. Put $C:\equiv\mathsf{isequiv}(g), D(p):\equiv(p_*(u)=_Cv)$. By Theorem 2.7.2 we have 
$$
((f,u)=(g,v))\simeq\sum_{p:f=g}D(p).
$$ 
We claim that the first projection 
$$
p_1:\sum_{p:f=g}D(p)\to(f=g)
$$ 
is an equivalence. This will imply 
$$
((f,u)=(g,v))\simeq(f=g).
$$ 
By Theorem 4.2.13 and the above reminders, $D(p)$ is contractible for all $p$, and Lemma 3.11.9 (i) implies that $p_1$ is indeed an equivalence.

%%

\subsection{Proof of Lemma 6.5.1}

The first display follows from Theorem 2.11.3.

%%

\section{Appendix A}

It seems to me that the expression $\lambda x.b$ is defined in two conflicting ways, firstly at the beginning of A.1, and secondly in the last sentence of A.2.4. 

\end{document}
